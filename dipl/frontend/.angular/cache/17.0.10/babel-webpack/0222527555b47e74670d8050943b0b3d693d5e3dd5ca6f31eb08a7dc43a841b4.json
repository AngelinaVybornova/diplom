{"ast":null,"code":"import _asyncToGenerator from \"D:/\\u0418\\u043D\\u0441\\u0442\\u0438\\u0442\\u0443\\u0442/8 \\u0441\\u0435\\u043C\\u0435\\u0441\\u0442\\u0440/Diplom/diplom/dipl/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CommonModule } from \"@angular/common\";\nimport { FormsModule } from \"@angular/forms\";\nimport { Svg } from \"./svgImage\";\nimport { UserData } from \"../models/models\";\nimport { lastValueFrom } from \"rxjs\";\nimport { HttpClientModule } from \"@angular/common/http\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../app.component\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/forms\";\nexport let SimulationFormComponent = /*#__PURE__*/(() => {\n  class SimulationFormComponent {\n    http;\n    M = 0;\n    N = 0;\n    user;\n    state;\n    appComponentClass;\n    svgClass;\n    userData = new UserData();\n    constructor(_appComponentClass, http) {\n      this.http = http;\n      this.appComponentClass = _appComponentClass;\n    }\n    stopSimulation() {\n      this.appComponentClass.formChange.next(\"stopSim\");\n    }\n    // тут пишем логику на typescript\n    animalsCount = 0;\n    ix;\n    cockroaches = [];\n    ngOnInit() {\n      this.svgClass = new Svg();\n      console.log(\"state\", this.state);\n      this.userData.User = this.user;\n      this.userData.CurrentState = this.state;\n      this.creatureHTML();\n      this.callNewState();\n      console.log(\"newState\", this.userData.CurrentState);\n      const bugIcons = document.getElementsByClassName(\"bug-icon\");\n      for (this.ix = 0; this.ix < bugIcons.length; this.ix++) {\n        this.makeCockroach(bugIcons[this.ix]);\n      }\n      this.step();\n      console.log(\"длина животных\", this.userData.CurrentState.animals.length);\n    }\n    callNewState() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.userData.CurrentState = yield _this.mainSimLoop(_this.userData);\n      })();\n    }\n    creatureHTML() {\n      const numberToBody = new Map([[0, this.svgClass.body1], [1, this.svgClass.body2], [10, this.svgClass.body3], [11, this.svgClass.body4]]);\n      const numberToHead = new Map([[0, this.svgClass.head1], [1, this.svgClass.head2], [10, this.svgClass.head3], [11, this.svgClass.head4]]);\n      const numberToEye = new Map([[0, this.svgClass.eye1], [1, this.svgClass.eye2], [10, this.svgClass.eye3], [11, this.svgClass.eye4]]);\n      const numberToMounth = new Map([[0, this.svgClass.mouth1], [1, this.svgClass.mouth2], [10, this.svgClass.mouth3], [11, this.svgClass.mouth4]]);\n      const numberToAdditional = new Map([[0, this.svgClass.add1], [1, this.svgClass.add2], [10, this.svgClass.add3], [11, this.svgClass.add4]]);\n      const app = document.getElementsByClassName(\"header\")[0];\n      for (let i = 0; i < this.userData.CurrentState.animals.length; i++) {\n        let microorganism = document.createElement(\"div\");\n        microorganism.style.position = \"absolute\";\n        microorganism.classList.add(\"bug-icon\");\n        let body = numberToBody.get(this.userData.CurrentState.animals[i].decipheredGenome.bodyType);\n        let haed = numberToHead.get(this.userData.CurrentState.animals[i].decipheredGenome.headType);\n        let eye = numberToEye.get(this.userData.CurrentState.animals[i].decipheredGenome.eyeType);\n        let mounth = numberToMounth.get(this.userData.CurrentState.animals[i].decipheredGenome.mouthType);\n        let additional = numberToAdditional.get(this.userData.CurrentState.animals[i].decipheredGenome.additionalType);\n        console.log(\"цвет\", this.userData.CurrentState.animals[i].decipheredGenome.bodyColor.b);\n        let rgb = `rgb(${this.userData.CurrentState.animals[i].decipheredGenome.bodyColor.r}, ${this.userData.CurrentState.animals[i].decipheredGenome.bodyColor.g}, ${this.userData.CurrentState.animals[i].decipheredGenome.bodyColor.b})`;\n        body = body.replace(/fill=\"#000000\"/, `fill=\"${rgb}\"`);\n        additional = additional.replace(/fill=\"#000000\"/, `fill=\"${rgb}\"`);\n        rgb = `rgb(${this.userData.CurrentState.animals[i].decipheredGenome.headColor.r}, ${this.userData.CurrentState.animals[i].decipheredGenome.headColor.g}, ${this.userData.CurrentState.animals[i].decipheredGenome.headColor.b})`;\n        haed = haed.replace(/fill=\"#000000\"/, `fill=\"${rgb}\"`);\n        mounth = mounth.replace(/fill=\"#000000\"/, `fill=\"${rgb}\"`);\n        rgb = `rgb(${this.userData.CurrentState.animals[i].decipheredGenome.eyeColor.r}, ${this.userData.CurrentState.animals[i].decipheredGenome.eyeColor.g}, ${this.userData.CurrentState.animals[i].decipheredGenome.eyeColor.b})`;\n        eye = eye.replace(/fill=\"#000000\"/, `fill=\"${rgb}\"`);\n        let animalVid = body + eye + mounth + additional;\n        haed = haed.replace(/<\\/svg>/, `${animalVid}</svg>`);\n        microorganism.innerHTML = haed;\n        app?.appendChild(microorganism);\n      }\n    }\n    deleteHTML() {}\n    makeCockroach(icon) {\n      const rect1 = document.querySelector(\".field\")?.getBoundingClientRect();\n      if (!rect1) return {\n        update: () => {}\n      }; // Проверка на наличие rect\n      let vspeed = 50;\n      const aspeed = 10 * Math.PI;\n      const p = document.createElement(\"img\");\n      let lastT = 0;\n      let lastTargetTime = -100;\n      let a = 0;\n      let x = Math.random() * (rect1.width - 20);\n      let y = Math.random() * (rect1.width - 20);\n      let tx = Math.random() * (rect1.width - 20);\n      let ty = Math.random() * (rect1.width - 20);\n      let dxy = 0;\n      console.log(\"координаты\", this.userData.CurrentState.animals[this.ix].coordinates[0]);\n      const svg = document.createElement(\"div\");\n      /*\n      svg.classList.add(\"bug-icon\");\n      const desiredColor = \"#00fa00\";\n      let add1 = this.svgClass.body1;\n      add1 = add1.replace(/fill=\"#000000\"/, `fill=\"${desiredColor}\"`);\n      svg.innerHTML = add1;\n      */\n      //svg.classList.add(\"bug-icon\");\n      const app = document.getElementsByClassName(\"field\")[0];\n      /*\n      const desiredColor = \"rgb(255, 0, 0)\";\n      let add1 = this.svgClass.head1;\n      add1 = add1.replace(/fill=\"#000000\"/, `fill=\"${desiredColor}\"`);\n      svg.innerHTML = add1;\n      console.log(\"картинка\", svg);\n      app?.appendChild(svg);\n      */\n      const update = (t, isUpd) => {\n        const rect = document.querySelector(\".field\")?.getBoundingClientRect();\n        if (!rect) return; // Проверка на наличие rect\n        if (t >= lastTargetTime + 5 /*&& isUpd == true*/) {\n          //document.getElementById(\"bug-container\").innerHTML = \"\";\n          p.remove;\n          //svg.remove;\n          tx = Math.random() * (rect.width - 20); // Ограничение по ширине\n          ty = Math.random() * (rect.height - 20); // Ограничение по высоте\n          //console.log(\"coords\", tx, ty);\n          //t = t * 1000;\n          lastTargetTime = t;\n          this.countAnimals();\n          console.log(\"счет\", isUpd);\n        } /*else if (t >= lastTargetTime + 5 && isUpd == false) {\n          //document.getElementById(\"bug-container\").innerHTML = \"\";\n          //document.getElementById(\"fieldHTML\").innerHTML = \"\";\n          //icon.remove;\n          p.remove;\n          //svg.remove;\n          tx = Math.random() * (rect.width - 20); // Ограничение по ширине\n          ty = Math.random() * (rect.height - 20); // Ограничение по высоте\n          //console.log(\"coords\", tx, ty);\n          //t = t * 1000;\n          lastTargetTime = t;\n          console.log(\"счет\", isUpd);\n               }*/\n        const dt = t - lastT;\n        //console.log(\"картинка\", icon);\n        //svg.innerHTML = \"\";\n        p.src = \"https://svgshare.com/i/t12.svg\";\n        p.style.position = \"absolute\";\n        p.style.left = tx + \"px\";\n        p.style.top = ty + \"px\";\n        app?.appendChild(p);\n        //(app as HTMLElement).style.backgroundColor = \"red\";\n        //console.log(\"новое\", tx, ty);\n        dxy = Math.sqrt(Math.pow(tx - x, 2) + Math.pow(ty - y, 2)) / 1000;\n        vspeed = dxy / dt;\n        //console.log(\"скорость\", vspeed, dt, dxy);\n        const ta = Math.atan2(ty - y, tx - x);\n        for (; a < ta; a += 2 * Math.PI) {}\n        for (; a > ta; a -= 2 * Math.PI) {}\n        const a2 = a + 2 * Math.PI;\n        if (ta - a < a2 - ta) {\n          a = Math.min(ta, a + dt * aspeed);\n        } else {\n          a = Math.max(ta, a2 - dt * aspeed);\n        }\n        //console.log(\"xxx\", tx, ty);\n        for (let frame = 0; frame < 30; frame++) {\n          x += dt * vspeed * Math.cos(a);\n          y += dt * vspeed * Math.sin(a);\n        }\n        icon.style.left = x + \"px\";\n        icon.style.top = y + \"px\";\n        icon.style.transform = \"rotate(\" + (180 * a / Math.PI - 270) + \"deg)\";\n        lastT = t;\n      };\n      const cockroach = {\n        update: update\n      };\n      this.cockroaches.push(cockroach);\n      return cockroach;\n    }\n    step() {\n      const t = performance.now() / 1000;\n      //let count = 1;\n      let isUpd = false;\n      for (const cockroach of this.cockroaches) {\n        cockroach.update(t, isUpd);\n        //count = count + 1;\n        //if (count == this.userData.CurrentState.animals.length) {\n        //isUpd = true;\n        //count = 1;\n        //}\n        //isUpd = false;\n      }\n\n      window.requestAnimationFrame(() => this.step());\n    }\n    countAnimals() {\n      this.animalsCount++;\n      if (this.animalsCount == this.userData.CurrentState.animals.length) {\n        this.removeCockroaches();\n        this.callNewState();\n        this.creatureHTML();\n        const bugIcons = document.getElementsByClassName(\"bug-icon\");\n        for (let i = 0; i < bugIcons.length; i++) {\n          this.makeCockroach(bugIcons[i]);\n        }\n        this.step();\n        this.animalsCount = 0;\n      }\n    }\n    removeCockroaches() {\n      this.cockroaches = []; // Очистка массива тараканов\n      const bugIcons = document.querySelectorAll(\".bug-icon\");\n      bugIcons.forEach(bugIcon => bugIcon.remove()); // Удаление элементов из DOM\n    }\n\n    mainSimLoop(data) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        return yield lastValueFrom(_this2.http.post(`http://localhost:4201/evoSim/mainSimLoop`, data));\n      })();\n    }\n    static ɵfac = function SimulationFormComponent_Factory(t) {\n      return new (t || SimulationFormComponent)(i0.ɵɵdirectiveInject(i1.AppComponent), i0.ɵɵdirectiveInject(i2.HttpClient));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: SimulationFormComponent,\n      selectors: [[\"simulationForm-comp\"]],\n      inputs: {\n        M: \"M\",\n        N: \"N\",\n        user: \"user\",\n        state: \"state\"\n      },\n      standalone: true,\n      features: [i0.ɵɵStandaloneFeature],\n      decls: 15,\n      vars: 4,\n      consts: [[1, \"navbar\", \"navbar-expand-sm\", \"bg-dark\", \"navbar-dark\"], [1, \"container-fluid\"], [1, \"navbar-nav\", \"mx-auto\"], [1, \"nav-item\"], [1, \"ligo\"], [1, \"d-flex\"], [\"id\", \"fieldHTML\", 1, \"field\"], [\"id\", \"bug-container\", 1, \"header\"], [1, \"center\"], [3, \"click\"], [\"height\", \"100\", \"width\", \"100\"], [0, \"xlink\", \"href\", \"/src/app/Animals/body1.svg\"]],\n      template: function SimulationFormComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"nav\", 0)(1, \"div\", 1)(2, \"ul\", 2)(3, \"li\", 3)(4, \"h1\", 4);\n          i0.ɵɵtext(5, \"\\u042D\\u0432\\u043E\\u043B\\u044E\\u0446\\u0438\\u044F\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelement(6, \"form\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(7, \"div\", 6);\n          i0.ɵɵelement(8, \"header\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(9, \"br\");\n          i0.ɵɵelementStart(10, \"div\", 8)(11, \"button\", 9);\n          i0.ɵɵlistener(\"click\", function SimulationFormComponent_Template_button_click_11_listener() {\n            return ctx.stopSimulation();\n          });\n          i0.ɵɵtext(12, \"\\u0417\\u0430\\u0432\\u0435\\u0440\\u0448\\u0438\\u0442\\u044C \\u0441\\u0438\\u043C\\u0443\\u043B\\u044F\\u0446\\u0438\\u044E\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵnamespaceSVG();\n          i0.ɵɵelementStart(13, \"svg\", 10);\n          i0.ɵɵelement(14, \"use\", 11);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵstyleProp(\"width\", ctx.M, \"px\")(\"height\", ctx.N, \"px\");\n        }\n      },\n      dependencies: [CommonModule, FormsModule, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.NgForm, HttpClientModule],\n      styles: [\".example[_ngcontent-%COMP%]{color:#006400;background-color:#5f9ea0}.ligo[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;float:none;color:#a6ff00}.field[_ngcontent-%COMP%]{position:relative;margin-top:30px;margin-left:auto;margin-right:auto;text-align:center;display:block;border:10px inset lightblue}.center[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{background-color:#93d21e}#bug-container[_ngcontent-%COMP%]{position:relative;height:200px}.bug-icon[_ngcontent-%COMP%]{height:25px;width:25px;position:absolute;top:0;left:0;z-index:0}\"]\n    });\n  }\n  return SimulationFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}